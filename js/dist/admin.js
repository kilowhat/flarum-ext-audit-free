module.exports=function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=17)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["helpers/username"]},function(t,e){t.exports=flarum.core.compat["components/Badge"]},function(t,e){t.exports=flarum.core.compat["models/Group"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["components/ExtensionPage"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["components/Placeholder"]},function(t,e){t.exports=flarum.core.compat["components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["components/GroupBadge"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a);function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=n(1),c=n.n(l),d=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return u(o(e=t.call.apply(t,[this].concat(a))||this),"actorId",c.a.attribute("actorId")),u(o(e),"client",c.a.attribute("client")),u(o(e),"ipAddress",c.a.attribute("ipAddress")),u(o(e),"action",c.a.attribute("action")),u(o(e),"payload",c.a.attribute("payload")),u(o(e),"createdAt",c.a.attribute("createdAt",c.a.transformDate)),u(o(e),"actor",c.a.hasOne("actor")),u(o(e),"discussion",c.a.hasOne("discussion")),u(o(e),"post",c.a.hasOne("post")),u(o(e),"tag",c.a.hasOne("tag")),u(o(e),"user",c.a.hasOne("user")),e}return i(e,t),e}(c.a),p=n(8),f=n.n(p),h=n(3),g=n.n(h),_=n(9),w=n.n(_),b=n(2),y=n.n(b),v=n(10),k=n.n(v),A=n(11),R=n.n(A),x=n(5),O=n.n(x),I=n(12),P=n.n(I),B=n(13),L=n.n(B),S=n(7),j=n.n(S),N=n(14),q=n.n(N),M=n(4),D=n.n(M),T=n(6),V=n.n(T),C=n(15),U=n.n(C),E=n(16),G=n.n(E),J="kilowhat-audit.lib.browser.";function Q(t,e){void 0===e&&(e=!1);var n=t?JSON.parse(JSON.stringify(t)):[];if(!n.length){if(!e)return m("em",r.a.translator.trans(J+"noValue"));n.push(V.a.ADMINISTRATOR_ID)}return n.map((function(t){if(t+""===V.a.GUEST_ID)return O.a.component({icon:"fas fa-globe",label:r.a.translator.trans(J+"permissionGroup.everyone")});if(t+""===V.a.MEMBER_ID)return O.a.component({icon:"fas fa-user",label:r.a.translator.trans(J+"permissionGroup.members")});var e=r.a.store.getById("groups",t);return e?L.a.component({group:e}):O.a.component({icon:"fas fa-question",label:U()(r.a.translator.trans(J+"deletedResource.group",{id:t}))})})).map((function(t,e){return[e>0?", ":null,t]}))}function z(t){return(t||[]).map((function(t,e){return[e>0?", ":null,m("code",t)]}))}var F=function(){function t(){}var e=t.prototype;return e.oninit=function(){this.showRaw=!1},e.view=function(t){var e,n,a,o=this,s=t.attrs,i=s.log,u=s.changeQuery,l=i.actor(),c=i.payload()||{},d=i.discussion(),p=i.post(),f=i.tag(),h=i.user(),_=[];i.ipAddress()&&_.push(m("a",{onclick:function(){u("ip:"+i.ipAddress())}},i.ipAddress())),"session"!==i.client()&&"cli"!==i.client()&&_.push(m("a",{onclick:function(){u("client:"+i.client())}},r.a.translator.trans(J+"client."+i.client()))),_.push(q()(i.createdAt())),e="cli"===i.client()?g()("fas fa-terminal"):null===i.actorId()?g()("fas fa-user-secret"):l?m("a",{href:l?r.a.route.user(l):"#"},j()(l)):j()(null),n="cli"===i.client()?m("a",{onclick:function(){u("client:cli")}},r.a.translator.trans(J+"client.cli")):null===i.actorId()?m("a",{onclick:function(){u("actor:guest")}},r.a.translator.trans(J+"withoutActor")):l?m("a",{onclick:function(){u("actor:"+l.username())}},D()(l)):D()(l);var w=J+i.action();if("setting_changed"===i.action()&&c.hasOwnProperty("new_value")&&(w=J+"setting_changed_with_values"),"string"==typeof r.a.translator.translations[w]){var b={username:m("a",{href:h?r.a.route.user(h):"#"},h?D()(h):r.a.translator.trans(J+"deletedResource.user",{id:c.user_id})),discussion:m("a",{href:d?r.a.route.discussion(d):"#"},d?d.title():r.a.translator.trans(J+"deletedResource.discussion",{id:c.discussion_id})),tag:m("a",{href:f?r.a.route.tag(f):"#"},f?f.name():r.a.translator.trans(J+"deletedResource.tag",{id:c.tag_id})),post:m("a",{href:p&&p.discussion()?r.a.route.post(p):"#"},p?r.a.translator.trans(J+"genericResource."+("comment"===p.contentType()?"comment":"post")):r.a.translator.trans(J+"deletedResource.post",{id:c.post_id})),postuser:m("a",{href:p&&p.user()?r.a.route.user(p.user()):"#"},D()(p?p.user():null)),until:c.until?dayjs(c.until).format("LLLL"):"?",old_title:m("em",c.old_title),new_title:c.new_title&&d?m("a",{href:r.a.route.discussion(d)},c.new_title):c.new_title,package:m("code",c.package),provider:m("code",c.provider),ip:m("code",c.ip),key:m("code",c.key),permission:m("code",c.permission),old_value:c.old_value?m("code",c.old_value):m("em",r.a.translator.trans(J+"noValue")),new_value:c.new_value?m("code",c.new_value):m("em",r.a.translator.trans(J+"noValue")),old_groups:Q(c.old_group_ids,"permission_changed"===i.action()),new_groups:Q(c.new_group_ids,"permission_changed"===i.action()),old_username:m("code",c.old_username),new_username:m("code",c.new_username),old_email:m("code",c.old_email),new_email:m("code",c.new_email),old_tags:z(c.old_tags),new_tags:z(c.new_tags),post_count:c.post_count,old_user:c.old_user_id?r.a.translator.trans(J+"deletedResource.user",{id:c.old_user_id}):m("em",r.a.translator.trans(J+"noValue")),new_user:c.new_user_id?r.a.translator.trans(J+"deletedResource.user",{id:c.new_user_id}):m("em",r.a.translator.trans(J+"noValue")),old_date:c.old_date?dayjs(c.old_date).format("LLLL"):m("em",r.a.translator.trans(J+"noValue")),new_date:c.new_date?dayjs(c.new_date).format("LLLL"):m("em",r.a.translator.trans(J+"noValue")),reason:c.reason?m("code",c.reason):m("em",r.a.translator.trans(J+"noReason"))};a=r.a.translator.trans(w,b),this.showRaw&&(a=[a,m("pre",JSON.stringify(c,null,2))])}else a=JSON.stringify(c);var v=new G.a;return v.add("raw",y.a.component({onclick:function(){o.showRaw=!o.showRaw}},r.a.translator.trans(J+"controls."+(this.showRaw?"hideRaw":"showRaw")))),l&&v.add("actor",y.a.component({onclick:function(){u("actor:"+l.username())}},r.a.translator.trans(J+"controls.filterActor"))),i.ipAddress()&&v.add("ip",y.a.component({onclick:function(){u("ip:"+i.ipAddress())}},r.a.translator.trans(J+"controls.filterIp"))),v.add("client",y.a.component({onclick:function(){u("client:"+i.client())}},r.a.translator.trans(J+"controls.filterClient"))),v.add("action",y.a.component({onclick:function(){u("action:"+i.action())}},r.a.translator.trans(J+"controls.filterAction"))),h&&v.add("user",y.a.component({onclick:function(){u("user:"+h.username())}},r.a.translator.trans(J+"controls.filterUser"))),c.discussion_id&&v.add("discussion",y.a.component({onclick:function(){u("discussion:"+c.discussion_id)}},r.a.translator.trans(J+"controls.filterDiscussion"))),m(".AuditItem",[m(".AuditItemAvatar",e),m(".AuditItemData",[P.a.component({menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",label:r.a.translator.trans(J+"controls"),icon:"fas fa-ellipsis-v"},v.toArray()),m(".AuditItemRow",[n," - ",m("a",{onclick:function(){u("action:"+i.action())}},i.action())]),m(".AuditItemRow",a),m(".AuditItemRow",_.map((function(t,e){return[0===e?null:" - ",t]})))])])},t}(),W=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.q="",this.loading=!0,this.moreResults=!1,this.logs=[],this.refresh()},n.view=function(){var t,e=this;return this.loading?t=k.a.component():this.moreResults&&(t=y.a.component({className:"Button Button--block",onclick:this.loadMore.bind(this)},r.a.translator.trans("kilowhat-audit.lib.browser.loadMore"))),m("div",[m(".AuditSearch",[m(".AuditSearchWrapper",[m("input.FormControl",{value:this.q,onchange:function(t){e.q=t.target.value},placeholder:r.a.translator.trans("kilowhat-audit.lib.browser.filterPlaceholder")}),this.q?y.a.component({className:"Search-clear Button Button--icon Button--link",onclick:function(){e.q="",e.refresh()},icon:"fas fa-times-circle"}):null]),y.a.component({className:"Button",onclick:function(){e.refresh()}},r.a.translator.trans("kilowhat-audit.lib.browser.filterApply"))]),0!==this.logs.length||this.loading?null:R.a.component({text:r.a.translator.trans("kilowhat-audit.lib.browser.empty")}),m(".AuditList",this.logs.map((function(t){return m(F,{log:t,changeQuery:function(t){e.q=t,e.refresh()}})}))),m(".AuditMore",t)])},n.requestParams=function(){var t={filter:{}},e=this.attrs.baseQ||"";return this.q&&(e+=" "+this.q),e&&(t.filter.q=e.trim()),t},n.refresh=function(t){var e=this;return void 0===t&&(t=!0),t&&(this.loading=!0,this.logs=[]),this.loadResults().then((function(t){e.logs=[],e.parseResults(t)}),(function(){e.loading=!1,m.redraw()}))},n.loadResults=function(t){var e=this.requestParams();return e.page={offset:t},r.a.store.find("kilowhat-audit/logs",e)},n.loadMore=function(){this.loading=!0,this.loadResults(this.logs.length).then(this.parseResults.bind(this))},n.parseResults=function(t){return[].push.apply(this.logs,t),this.loading=!1,this.moreResults=!!t.payload.links.next,m.redraw(),t},e}(w.a),H=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var n=e.prototype;return n.className=function(){return t.prototype.className.call(this)+" AuditPage"},n.header=function(){var e=t.prototype.header.call(this);return e[0].children.push(g()("fas fa-book",{className:"AuditBanner"})),e[0].children[0].children[0].children[1].children=[m("h2",[r.a.translator.trans("kilowhat-audit.admin.header.title"),m("span.badge",r.a.translator.trans("kilowhat-audit.admin.header.free")),m("a.AuditUpgrade",{target:"_blank",href:"https://kilowhat.net/flarum/extensions/audit"},[g()("fas fa-rocket")," ",r.a.translator.trans("kilowhat-audit.admin.header.upgrade")])])],e},n.content=function(){return m(".AuditPageContainer",m(W))},e}(f.a);r.a.initializers.add("kilowhat-audit",(function(){r.a.store.models["kilowhat-audit"]=d,r.a.route.discussion||(r.a.route.discussion=function(t){return r.a.forum.attribute("baseUrl")+"/d/"+t.id()}),r.a.route.post||(r.a.route.post=function(t){return r.a.route.discussion(t.discussion())+"/"+t.number()}),r.a.route.tag||(r.a.route.tag=function(t){return r.a.forum.attribute("baseUrl")+"/t/"+t.slug()}),r.a.route.user||(r.a.route.user=function(t){return r.a.forum.attribute("baseUrl")+"/u/"+t.username()}),r.a.extensionData.for("kilowhat-audit-free").registerPage(H)}))}]);
//# sourceMappingURL=admin.js.map