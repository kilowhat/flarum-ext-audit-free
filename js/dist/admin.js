module.exports=function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(a,o,function(e){return t[e]}.bind(null,o));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=21)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["helpers/username"]},function(t,e){t.exports=flarum.core.compat["components/Badge"]},function(t,e){t.exports=flarum.core.compat["models/Group"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,e){t.exports=flarum.core.compat["components/AdminNav"]},function(t,e){t.exports=flarum.core.compat["components/Page"]},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["components/Placeholder"]},function(t,e){t.exports=flarum.core.compat["components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["components/GroupBadge"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a);function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var i=n(1),s=n.n(i),u=n(9),c=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(n.n(u)()(s.a,{actorId:s.a.attribute("actorId"),client:s.a.attribute("client"),ipAddress:s.a.attribute("ipAddress"),action:s.a.attribute("action"),payload:s.a.attribute("payload"),createdAt:s.a.attribute("createdAt",s.a.transformDate),actor:s.a.hasOne("actor"),discussion:s.a.hasOne("discussion"),post:s.a.hasOne("post"),tag:s.a.hasOne("tag"),user:s.a.hasOne("user")})),l=n(10),d=n(11),p=n.n(d),f=n(12),h=n.n(f),g=n(13),w=n.n(g),_=n(4),y=n.n(_),k=n(2),b=n.n(k),v=n(14),x=n.n(v),A=n(15),R=n.n(A),O=n(6),I=n.n(O),B=n(16),L=n.n(B),S=n(17),Q=n.n(S),P=n(8),q=n.n(P),M=n(18),N=n.n(M),j=n(3),D=n.n(j),T=n(5),V=n.n(T),C=n(7),U=n.n(C),G=n(19),J=n.n(G),E=n(20),z=n.n(E),F="kilowhat-audit.lib.browser.";function H(t,e){void 0===e&&(e=!1);var n=t?JSON.parse(JSON.stringify(t)):[];if(!n.length){if(!e)return m("em",o.a.translator.trans(F+"noValue"));n.push(U.a.ADMINISTRATOR_ID)}return n.map((function(t){if(t+""===U.a.GUEST_ID)return I.a.component({icon:"fas fa-globe",label:o.a.translator.trans(F+"permissionGroup.everyone")});if(t+""===U.a.MEMBER_ID)return I.a.component({icon:"fas fa-user",label:o.a.translator.trans(F+"permissionGroup.members")});var e=o.a.store.getById("groups",t);return e?Q.a.component({group:e}):I.a.component({icon:"fas fa-question",label:J()(o.a.translator.trans(F+"deletedResource.group",{id:t}))})})).map((function(t,e){return[e>0?", ":null,t]}))}function W(t){return(t||[]).map((function(t,e){return[e>0?", ":null,m("code",t)]}))}var K=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.init=function(){t.prototype.init.call(this),this.showRaw=!1},n.view=function(){var t,e,n,a=this,r=this.props.log,i=r.actor(),s=r.payload()||{},u=r.discussion(),c=r.post(),l=r.tag(),d=r.user(),p=[];r.ipAddress()&&p.push(m("a",{onclick:function(){a.props.changeQuery("ip:"+r.ipAddress())}},r.ipAddress())),"session"!==r.client()&&"cli"!==r.client()&&p.push(m("a",{onclick:function(){a.props.changeQuery("client:"+r.client())}},o.a.translator.trans(F+"client."+r.client()))),p.push(N()(r.createdAt())),t="cli"===r.client()?D()("fas fa-terminal"):null===r.actorId()?D()("fas fa-user-secret"):i?m("a",{href:i?o.a.route.user(i):"#"},q()(i)):q()(null),e="cli"===r.client()?m("a",{onclick:function(){a.props.changeQuery("client:cli")}},o.a.translator.trans(F+"client.cli")):null===r.actorId()?m("a",{onclick:function(){a.props.changeQuery("actor:guest")}},o.a.translator.trans(F+"withoutActor")):i?m("a",{onclick:function(){a.props.changeQuery("actor:"+i.username())}},V()(i)):V()(i);var f=F+r.action();if("setting_changed"===r.action()&&s.hasOwnProperty("new_value")&&(f=F+"setting_changed_with_values"),"string"==typeof o.a.translator.translations[f]){var h={username:m("a",{href:d?o.a.route.user(d):"#"},d?V()(d):o.a.translator.trans(F+"deletedResource.user",{id:s.user_id})),discussion:m("a",{href:u?o.a.route.discussion(u):"#"},u?u.title():o.a.translator.trans(F+"deletedResource.discussion",{id:s.discussion_id})),tag:m("a",{href:l?o.a.route.tag(l):"#"},l?l.name():o.a.translator.trans(F+"deletedResource.tag",{id:s.tag_id})),post:m("a",{href:c&&c.discussion()?o.a.route.post(c):"#"},c?o.a.translator.trans(F+"genericResource."+("comment"===c.contentType()?"comment":"post")):o.a.translator.trans(F+"deletedResource.post",{id:s.post_id})),postuser:m("a",{href:c&&c.user()?o.a.route.user(c.user()):"#"},V()(c?c.user():null)),until:s.until?moment(s.until).format("LLLL"):"?",old_title:m("em",s.old_title),new_title:s.new_title&&u?m("a",{href:o.a.route.discussion(u)},s.new_title):s.new_title,package:m("code",s.package),provider:m("code",s.provider),ip:m("code",s.ip),key:m("code",s.key),permission:m("code",s.permission),old_value:s.old_value?m("code",s.old_value):m("em",o.a.translator.trans(F+"noValue")),new_value:s.new_value?m("code",s.new_value):m("em",o.a.translator.trans(F+"noValue")),old_groups:H(s.old_group_ids,"permission_changed"===r.action()),new_groups:H(s.new_group_ids,"permission_changed"===r.action()),old_username:m("code",s.old_username),new_username:m("code",s.new_username),old_email:m("code",s.old_email),new_email:m("code",s.new_email),old_tags:W(s.old_tags),new_tags:W(s.new_tags),post_count:s.post_count,old_user:s.old_user_id?o.a.translator.trans(F+"deletedResource.user",{id:s.old_user_id}):m("em",o.a.translator.trans(F+"noValue")),new_user:s.new_user_id?o.a.translator.trans(F+"deletedResource.user",{id:s.new_user_id}):m("em",o.a.translator.trans(F+"noValue")),old_date:s.old_date?moment(s.old_date).format("LLLL"):m("em",o.a.translator.trans(F+"noValue")),new_date:s.new_date?moment(s.new_date).format("LLLL"):m("em",o.a.translator.trans(F+"noValue"))};n=o.a.translator.trans(f,h),this.showRaw&&(n=[n,m("pre",JSON.stringify(s,null,2))])}else n=JSON.stringify(s);var g=new z.a;return g.add("raw",b.a.component({children:o.a.translator.trans(F+"controls."+(this.showRaw?"hideRaw":"showRaw")),onclick:function(){a.showRaw=!a.showRaw}})),i&&g.add("actor",b.a.component({children:o.a.translator.trans(F+"controls.filterActor"),onclick:function(){a.props.changeQuery("actor:"+i.username())}})),r.ipAddress()&&g.add("ip",b.a.component({children:o.a.translator.trans(F+"controls.filterIp"),onclick:function(){a.props.changeQuery("ip:"+r.ipAddress())}})),g.add("client",b.a.component({children:o.a.translator.trans(F+"controls.filterClient"),onclick:function(){a.props.changeQuery("client:"+r.client())}})),g.add("action",b.a.component({children:o.a.translator.trans(F+"controls.filterAction"),onclick:function(){a.props.changeQuery("action:"+r.action())}})),d&&g.add("user",b.a.component({children:o.a.translator.trans(F+"controls.filterUser"),onclick:function(){a.props.changeQuery("user:"+d.username())}})),s.discussion_id&&g.add("discussion",b.a.component({children:o.a.translator.trans(F+"controls.filterDiscussion"),onclick:function(){a.props.changeQuery("discussion:"+s.discussion_id)}})),m(".AuditItem",[m(".AuditItemAvatar",t),m(".AuditItemData",[L.a.component({children:g.toArray(),menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",label:o.a.translator.trans(F+"controls"),icon:"fas fa-ellipsis-v"}),m(".AuditItemRow",[e," - ",m("a",{onclick:function(){a.props.changeQuery("action:"+r.action())}},r.action())]),m(".AuditItemRow",n),m(".AuditItemRow",p.map((function(t,e){return[0===e?null:" - ",t]})))])])},e}(y.a),X=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.init=function(){this.q="",this.loading=!0,this.moreResults=!1,this.logs=[],this.refresh()},n.view=function(){var t,e=this;return this.loading?t=x.a.component():this.moreResults&&(t=b.a.component({children:o.a.translator.trans("kilowhat-audit.lib.browser.loadMore"),className:"Button Button--block",onclick:this.loadMore.bind(this)})),m("div",[m(".AuditSearch",[m(".AuditSearchWrapper",[m("input.FormControl",{value:this.q,onchange:function(t){e.q=t.target.value},placeholder:o.a.translator.trans("kilowhat-audit.lib.browser.filterPlaceholder")}),this.q?b.a.component({className:"Search-clear Button Button--icon Button--link",onclick:function(){e.q="",e.refresh()},icon:"fas fa-times-circle"}):null]),b.a.component({className:"Button",onclick:function(){e.refresh()},children:o.a.translator.trans("kilowhat-audit.lib.browser.filterApply")})]),0!==this.logs.length||this.loading?null:R.a.component({text:o.a.translator.trans("kilowhat-audit.lib.browser.empty")}),m(".AuditList",this.logs.map((function(t){return K.component({log:t,changeQuery:function(t){e.q=t,e.refresh()}})}))),m(".AuditMore",t)])},n.requestParams=function(){var t={filter:{}},e=this.props.baseQ||"";return this.q&&(e+=" "+this.q),e&&(t.filter.q=e.trim()),t},n.refresh=function(t){var e=this;return void 0===t&&(t=!0),t&&(this.loading=!0,this.logs=[]),this.loadResults().then((function(t){e.logs=[],e.parseResults(t)}),(function(){e.loading=!1,m.redraw()}))},n.loadResults=function(t){var e=this.requestParams();return e.page={offset:t},o.a.store.find("kilowhat-audit/logs",e)},n.loadMore=function(){this.loading=!0,this.loadResults(this.logs.length).then(this.parseResults.bind(this))},n.parseResults=function(t){return[].push.apply(this.logs,t),this.loading=!1,this.moreResults=!!t.payload.links.next,m.lazyRedraw(),t},e}(y.a),Y=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.view=function(){return m(".AuditHeader",[D()("fas fa-book",{className:"AuditBanner"}),m("h1",[o.a.translator.trans("kilowhat-audit.admin.header.title"),m("span.badge",o.a.translator.trans("kilowhat-audit.admin.header.free")),m("a.AuditUpgrade",{target:"_blank",href:"https://kilowhat.net/flarum/extensions/audit"},[D()("fas fa-rocket")," ",o.a.translator.trans("kilowhat-audit.admin.header.upgrade")])]),m("ul",[m("li",m("a",{target:"_blank",href:"https://kilowhat.net/flarum/extensions/audit"},[o.a.translator.trans("kilowhat-audit.admin.header.documentation")," ",D()("fas fa-external-link-alt")])),m("li",m("a",{target:"_blank",href:"https://discuss.flarum.org/d/24432"},[o.a.translator.trans("kilowhat-audit.admin.header.discuss")," ",D()("fas fa-external-link-alt")])),m("li",o.a.translator.trans("kilowhat-audit.admin.header.version",{version:o.a.data.extensions["kilowhat-audit-free"].version}))])])},e}(y.a),Z=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.view=function(){return m(".AuditPage",m(".AuditPageContainer",[Y.component(),X.component()]))},e}(w.a);o.a.initializers.add("kilowhat-audit",(function(){o.a.store.models["kilowhat-audit"]=c,o.a.route.discussion||(o.a.route.discussion=function(t){return o.a.forum.attribute("baseUrl")+"/d/"+t.id()}),o.a.route.post||(o.a.route.post=function(t){return o.a.route.discussion(t.discussion())+"/"+t.number()}),o.a.route.tag||(o.a.route.tag=function(t){return o.a.forum.attribute("baseUrl")+"/t/"+t.slug()}),o.a.route.user||(o.a.route.user=function(t){return o.a.forum.attribute("baseUrl")+"/u/"+t.username()}),o.a.routes["kilowhat-audit"]={path:"/audit",component:Z.component()},o.a.extensionSettings["kilowhat-audit-free"]=function(){return m.route(o.a.route("kilowhat-audit"))},Object(l.extend)(h.a.prototype,"items",(function(t){t.add("kilowhat-audit",p.a.component({href:o.a.route("kilowhat-audit"),icon:"fas fa-book",children:o.a.translator.trans("kilowhat-audit.admin.menu.title"),description:o.a.translator.trans("kilowhat-audit.admin.menu.description")}))}))}))}]);
//# sourceMappingURL=admin.js.map