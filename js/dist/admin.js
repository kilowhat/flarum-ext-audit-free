module.exports=function(t){var n={};function a(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=t,a.c=n,a.d=function(t,n,e){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)a.d(e,o,function(n){return t[n]}.bind(null,o));return e},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="",a(a.s=21)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat.Model},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n){t.exports=flarum.core.compat["helpers/icon"]},function(t,n){t.exports=flarum.core.compat["helpers/username"]},function(t,n){t.exports=flarum.core.compat["components/Badge"]},function(t,n){t.exports=flarum.core.compat["models/Group"]},function(t,n){t.exports=flarum.core.compat["helpers/avatar"]},function(t,n){t.exports=flarum.core.compat["utils/mixin"]},function(t,n){t.exports=flarum.core.compat.extend},function(t,n){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,n){t.exports=flarum.core.compat["components/AdminNav"]},function(t,n){t.exports=flarum.core.compat["components/Page"]},function(t,n){t.exports=flarum.core.compat.Component},function(t,n){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["components/Placeholder"]},function(t,n){t.exports=flarum.core.compat["components/Dropdown"]},function(t,n){t.exports=flarum.core.compat["components/GroupBadge"]},function(t,n){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,n){t.exports=flarum.core.compat["utils/extractText"]},function(t,n){t.exports=flarum.core.compat["utils/ItemList"]},function(t,n,a){"use strict";a.r(n);var e=a(0),o=a.n(e);function r(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}var i=a(1),s=a.n(i),u=a(8),l=function(t){function n(){return t.apply(this,arguments)||this}return r(n,t),n}(a.n(u)()(s.a,{actorId:s.a.attribute("actorId"),client:s.a.attribute("client"),ipAddress:s.a.attribute("ipAddress"),action:s.a.attribute("action"),payload:s.a.attribute("payload"),createdAt:s.a.attribute("createdAt",s.a.transformDate),actor:s.a.hasOne("actor"),discussion:s.a.hasOne("discussion"),post:s.a.hasOne("post"),tag:s.a.hasOne("tag"),user:s.a.hasOne("user")})),c=a(9),d=a(10),p=a.n(d),f=a(11),h=a.n(f),g=a(12),w=a.n(g),_=a(13),k=a.n(_),b=a(2),v=a.n(b),y=a(14),x=a.n(y),A=a(15),R=a.n(A),O=a(5),I=a.n(O),B=a(16),L=a.n(B),S=a(17),P=a.n(S),q=a(7),M=a.n(q),N=a(18),j=a.n(N),D=a(3),T=a.n(D),V=a(4),C=a.n(V),U=a(6),G=a.n(U),J=a(19),E=a.n(J),Q=a(20),z=a.n(Q),F="kilowhat-audit.lib.browser.";function H(t,n){void 0===n&&(n=!1);var a=t?JSON.parse(JSON.stringify(t)):[];if(!a.length){if(!n)return m("em",o.a.translator.trans(F+"noValue"));a.push(G.a.ADMINISTRATOR_ID)}return a.map((function(t){if(t+""===G.a.GUEST_ID)return I.a.component({icon:"fas fa-globe",label:o.a.translator.trans(F+"permissionGroup.everyone")});if(t+""===G.a.MEMBER_ID)return I.a.component({icon:"fas fa-user",label:o.a.translator.trans(F+"permissionGroup.members")});var n=o.a.store.getById("groups",t);return n?P.a.component({group:n}):I.a.component({icon:"fas fa-question",label:E()(o.a.translator.trans(F+"deletedResource.group",{id:t}))})})).map((function(t,n){return[n>0?", ":null,t]}))}function W(t){return(t||[]).map((function(t,n){return[n>0?", ":null,m("code",t)]}))}var K=function(){function t(){}var n=t.prototype;return n.oninit=function(){this.showRaw=!1},n.view=function(t){var n,a,e,r=this,i=t.attrs,s=i.log,u=i.changeQuery,l=s.actor(),c=s.payload()||{},d=s.discussion(),p=s.post(),f=s.tag(),h=s.user(),g=[];s.ipAddress()&&g.push(m("a",{onclick:function(){u("ip:"+s.ipAddress())}},s.ipAddress())),"session"!==s.client()&&"cli"!==s.client()&&g.push(m("a",{onclick:function(){u("client:"+s.client())}},o.a.translator.trans(F+"client."+s.client()))),g.push(j()(s.createdAt())),n="cli"===s.client()?T()("fas fa-terminal"):null===s.actorId()?T()("fas fa-user-secret"):l?m("a",{href:l?o.a.route.user(l):"#"},M()(l)):M()(null),a="cli"===s.client()?m("a",{onclick:function(){u("client:cli")}},o.a.translator.trans(F+"client.cli")):null===s.actorId()?m("a",{onclick:function(){u("actor:guest")}},o.a.translator.trans(F+"withoutActor")):l?m("a",{onclick:function(){u("actor:"+l.username())}},C()(l)):C()(l);var w=F+s.action();if("setting_changed"===s.action()&&c.hasOwnProperty("new_value")&&(w=F+"setting_changed_with_values"),"string"==typeof o.a.translator.translations[w]){var _={username:m("a",{href:h?o.a.route.user(h):"#"},h?C()(h):o.a.translator.trans(F+"deletedResource.user",{id:c.user_id})),discussion:m("a",{href:d?o.a.route.discussion(d):"#"},d?d.title():o.a.translator.trans(F+"deletedResource.discussion",{id:c.discussion_id})),tag:m("a",{href:f?o.a.route.tag(f):"#"},f?f.name():o.a.translator.trans(F+"deletedResource.tag",{id:c.tag_id})),post:m("a",{href:p&&p.discussion()?o.a.route.post(p):"#"},p?o.a.translator.trans(F+"genericResource."+("comment"===p.contentType()?"comment":"post")):o.a.translator.trans(F+"deletedResource.post",{id:c.post_id})),postuser:m("a",{href:p&&p.user()?o.a.route.user(p.user()):"#"},C()(p?p.user():null)),until:c.until?moment(c.until).format("LLLL"):"?",old_title:m("em",c.old_title),new_title:c.new_title&&d?m("a",{href:o.a.route.discussion(d)},c.new_title):c.new_title,package:m("code",c.package),provider:m("code",c.provider),ip:m("code",c.ip),key:m("code",c.key),permission:m("code",c.permission),old_value:c.old_value?m("code",c.old_value):m("em",o.a.translator.trans(F+"noValue")),new_value:c.new_value?m("code",c.new_value):m("em",o.a.translator.trans(F+"noValue")),old_groups:H(c.old_group_ids,"permission_changed"===s.action()),new_groups:H(c.new_group_ids,"permission_changed"===s.action()),old_username:m("code",c.old_username),new_username:m("code",c.new_username),old_email:m("code",c.old_email),new_email:m("code",c.new_email),old_tags:W(c.old_tags),new_tags:W(c.new_tags),post_count:c.post_count,old_user:c.old_user_id?o.a.translator.trans(F+"deletedResource.user",{id:c.old_user_id}):m("em",o.a.translator.trans(F+"noValue")),new_user:c.new_user_id?o.a.translator.trans(F+"deletedResource.user",{id:c.new_user_id}):m("em",o.a.translator.trans(F+"noValue")),old_date:c.old_date?moment(c.old_date).format("LLLL"):m("em",o.a.translator.trans(F+"noValue")),new_date:c.new_date?moment(c.new_date).format("LLLL"):m("em",o.a.translator.trans(F+"noValue")),reason:c.reason?m("code",c.reason):m("em",o.a.translator.trans(F+"noReason"))};e=o.a.translator.trans(w,_),this.showRaw&&(e=[e,m("pre",JSON.stringify(c,null,2))])}else e=JSON.stringify(c);var k=new z.a;return k.add("raw",v.a.component({onclick:function(){r.showRaw=!r.showRaw}},o.a.translator.trans(F+"controls."+(this.showRaw?"hideRaw":"showRaw")))),l&&k.add("actor",v.a.component({onclick:function(){u("actor:"+l.username())}},o.a.translator.trans(F+"controls.filterActor"))),s.ipAddress()&&k.add("ip",v.a.component({onclick:function(){u("ip:"+s.ipAddress())}},o.a.translator.trans(F+"controls.filterIp"))),k.add("client",v.a.component({onclick:function(){u("client:"+s.client())}},o.a.translator.trans(F+"controls.filterClient"))),k.add("action",v.a.component({onclick:function(){u("action:"+s.action())}},o.a.translator.trans(F+"controls.filterAction"))),h&&k.add("user",v.a.component({onclick:function(){u("user:"+h.username())}},o.a.translator.trans(F+"controls.filterUser"))),c.discussion_id&&k.add("discussion",v.a.component({onclick:function(){u("discussion:"+c.discussion_id)}},o.a.translator.trans(F+"controls.filterDiscussion"))),m(".AuditItem",[m(".AuditItemAvatar",n),m(".AuditItemData",[L.a.component({menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",label:o.a.translator.trans(F+"controls"),icon:"fas fa-ellipsis-v"},k.toArray()),m(".AuditItemRow",[a," - ",m("a",{onclick:function(){u("action:"+s.action())}},s.action())]),m(".AuditItemRow",e),m(".AuditItemRow",g.map((function(t,n){return[0===n?null:" - ",t]})))])])},t}(),X=function(t){function n(){return t.apply(this,arguments)||this}r(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.q="",this.loading=!0,this.moreResults=!1,this.logs=[],this.refresh()},a.view=function(){var t,n=this;return this.loading?t=x.a.component():this.moreResults&&(t=v.a.component({className:"Button Button--block",onclick:this.loadMore.bind(this)},o.a.translator.trans("kilowhat-audit.lib.browser.loadMore"))),m("div",[m(".AuditSearch",[m(".AuditSearchWrapper",[m("input.FormControl",{value:this.q,onchange:function(t){n.q=t.target.value},placeholder:o.a.translator.trans("kilowhat-audit.lib.browser.filterPlaceholder")}),this.q?v.a.component({className:"Search-clear Button Button--icon Button--link",onclick:function(){n.q="",n.refresh()},icon:"fas fa-times-circle"}):null]),v.a.component({className:"Button",onclick:function(){n.refresh()}},o.a.translator.trans("kilowhat-audit.lib.browser.filterApply"))]),0!==this.logs.length||this.loading?null:R.a.component({text:o.a.translator.trans("kilowhat-audit.lib.browser.empty")}),m(".AuditList",this.logs.map((function(t){return m(K,{log:t,changeQuery:function(t){n.q=t,n.refresh()}})}))),m(".AuditMore",t)])},a.requestParams=function(){var t={filter:{}},n=this.attrs.baseQ||"";return this.q&&(n+=" "+this.q),n&&(t.filter.q=n.trim()),t},a.refresh=function(t){var n=this;return void 0===t&&(t=!0),t&&(this.loading=!0,this.logs=[]),this.loadResults().then((function(t){n.logs=[],n.parseResults(t)}),(function(){n.loading=!1,m.redraw()}))},a.loadResults=function(t){var n=this.requestParams();return n.page={offset:t},o.a.store.find("kilowhat-audit/logs",n)},a.loadMore=function(){this.loading=!0,this.loadResults(this.logs.length).then(this.parseResults.bind(this))},a.parseResults=function(t){return[].push.apply(this.logs,t),this.loading=!1,this.moreResults=!!t.payload.links.next,m.redraw(),t},n}(k.a),Y=function(){function t(){}return t.prototype.view=function(){return m(".AuditHeader",[T()("fas fa-book",{className:"AuditBanner"}),m("h1",[o.a.translator.trans("kilowhat-audit.admin.header.title"),m("span.badge",o.a.translator.trans("kilowhat-audit.admin.header.free")),m("a.AuditUpgrade",{target:"_blank",href:"https://kilowhat.net/flarum/extensions/audit"},[T()("fas fa-rocket")," ",o.a.translator.trans("kilowhat-audit.admin.header.upgrade")])]),m("ul",[m("li",m("a",{target:"_blank",href:"https://kilowhat.net/flarum/extensions/audit"},[o.a.translator.trans("kilowhat-audit.admin.header.documentation")," ",T()("fas fa-external-link-alt")])),m("li",m("a",{target:"_blank",href:"https://discuss.flarum.org/d/24432"},[o.a.translator.trans("kilowhat-audit.admin.header.discuss")," ",T()("fas fa-external-link-alt")])),m("li",o.a.translator.trans("kilowhat-audit.admin.header.version",{version:o.a.data.extensions["kilowhat-audit-free"].version}))])])},t}(),Z=function(t){function n(){return t.apply(this,arguments)||this}return r(n,t),n.prototype.view=function(){return m(".AuditPage",m(".AuditPageContainer",[m(Y),m(X)]))},n}(w.a);o.a.initializers.add("kilowhat-audit",(function(){o.a.store.models["kilowhat-audit"]=l,o.a.route.discussion||(o.a.route.discussion=function(t){return o.a.forum.attribute("baseUrl")+"/d/"+t.id()}),o.a.route.post||(o.a.route.post=function(t){return o.a.route.discussion(t.discussion())+"/"+t.number()}),o.a.route.tag||(o.a.route.tag=function(t){return o.a.forum.attribute("baseUrl")+"/t/"+t.slug()}),o.a.route.user||(o.a.route.user=function(t){return o.a.forum.attribute("baseUrl")+"/u/"+t.username()}),o.a.routes["kilowhat-audit"]={path:"/audit",component:Z},o.a.extensionSettings["kilowhat-audit-free"]=function(){return m.route.set(o.a.route("kilowhat-audit"))},Object(c.extend)(h.a.prototype,"items",(function(t){t.add("kilowhat-audit",p.a.component({href:o.a.route("kilowhat-audit"),icon:"fas fa-book",description:o.a.translator.trans("kilowhat-audit.admin.menu.description")},o.a.translator.trans("kilowhat-audit.admin.menu.title")))}))}))}]);
//# sourceMappingURL=admin.js.map